<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<body>
<div id="modal" class="modal fade" tabindex="-1" aria-hidden="true" th:fragment="modal_div">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">准入审核</h4>
            </div>
            <form id="submit_form" method="post" novalidate="novalidate" onsubmit="return false;">
                <div class="modal-body">
                    <div class="scroller" style="height:270px" data-always-visible="1" data-rail-visible1="1">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="alert alert-danger display-hide" style="display: hide;"id="error_div">
                                    <button class="close" data-close="alert"></button> <span id="check_msg"></span>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">审核状态<span class="required" aria-required="true"> * </span></label><span id="add_status_check"></span>
                                    <div class="col-md-9">
                                        <div class="mt-radio-inline">
                                            <label class="mt-radio">
                                                <input type="radio" name="status" value="2" checked="checked">审核通过
                                                <span></span>
                                            </label>
                                            <label class="mt-radio">
                                                <input type="radio" name="status" value="3">审核未通过
                                                <span></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label">备注</label>
                                    <textarea class="form-control" rows="5" id="memo" name="memo" type="text" placeholder="审核未通过必填此项"></textarea>
                                </div>

                            </div>
                            <div class="col-md-6">
                                <label class="control-label">监管规则:</label>
                                <div style="margin-left: 15px">
                                    <input type="radio" name="supervise" value="准入规则" checked="checked">准入规则 &nbsp;&nbsp;
                                    <input type="radio" name="supervise" value="执业规则">执业规则 &nbsp;&nbsp;
                                    <input type="radio" name="supervise" value="管理规则">管理规则 &nbsp;
                                </div>
                                <select class="form-control" data-selectsplitter-firstselect-selector="" size="8" id="select_supervise"></select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" data-dismiss="modal" class="btn dark btn-outline">取消</button>
                    <button type="submit" class="btn green">确定</button>
                </div>
            </form>
        </div>

        <script type="text/javascript">
            var handleAdd = function() {
                $('#submit_form').attr("action",ctx+"/nmis/api/applyTask/updateTask");
                var form1 = $('#submit_form');
                var success1 = $('.alert-success', form1);

                form1.validate({
                    errorElement: 'span', //default input error message container
                    errorClass: 'help-block help-block-error', // default input error message class
                    focusInvalid: false, // do not focus the last invalid input
                    ignore: "",  // validate all fields including form hidden input
                    messages: {
                        // authority:{
                        //     required:''
                        // },
                    },
                    rules: {
                        // authority: {
                        //     required: true
                        // },
                    },
                    invalidHandler: function (event, validator) { //display error alert on form submit
                        success1.hide();
//                error1.show();
//                App.scrollTo(error1, -200);
                    },
                    errorPlacement: function (error, element) { // render error placement for each input type
                        // var cont = $(element).parent('.input-group');
                        // if (cont.size() > 0) {
                        //     cont.after(error);
                        // } else {
                        //     element.after(error);
                        // }
                        error.appendTo( element.parent().next() );
                    },
                    highlight: function (element) { // hightlight error inputs

                        $(element)
                            .closest('.form-group').addClass('has-error'); // set error class to the control group
                    },
                    unhighlight: function (element) { // revert the change done by hightlight
                        $(element)
                            .closest('.form-group').removeClass('has-error'); // set error class to the control group
                    },
                    success: function (label) {
                        label
                            .closest('.form-group').removeClass('has-error'); // set success class to the control group
                    },
                    submitHandler: function (form) {
                        // if(!bodypartResult){
                        // success1.show();

                        // form.submit();
                        var taskCode =  "nm_apply_"+window.location.pathname.substr(window.location.pathname.lastIndexOf("/")+1);
                        var id = $("#userId").val();
                        $.ajaxSettings.async = false; //同步
                        $.post(form1.attr("action"),$.param({"taskCode":taskCode,"userId":id})+'&'+form1.serialize(),function(data,status){
                            if(data.resultCode == '200'){
                                $('#modal').modal('hide');
                                window.location.href = ctx+"/nmis/apply/examine/detail/"+id
                            }
                            // if(data.resultCode == '300'){
                            //     $("#error_div").show();
                            //     $("#check_msg").html(data.resultMsg);
                            // }
                        });
                        // }
                    }
                });
            }
            function exam() {
                $("#modal").modal();
            }
            $("#select_supervise").change(function(){
                $("#memo").html($(this).val());
            });

            function ruleGroup(rule) {
                    var data = {"ruleGroup":rule};
                    $.post(ctx+"/nmis/api/superviseRule/ruleList",data,function(res){
                        if(res.resultCode == '200'){
                            var data = res.data;
                            var parent = $("#select_supervise").html("");
                            // parent.append('<option value=""></option>');
                            for(var i=0;i<data.length;i++){
                                parent.append('<option value="'+data[i].ruleMemo+'">'+data[i].ruleTitle+'</option>');
                            }
                        }
                    });
            }
            $(function () {
                console.log(window.location.pathname.substr(window.location.pathname.lastIndexOf("/")+1));
                $("input[name='supervise']").click(function(){
                    ruleGroup($(this).val());
                });
                ruleGroup($("input[name='supervise']:checked").val());
                handleAdd();
            })
        </script>
    </div>
</div>
</body>
</html>
